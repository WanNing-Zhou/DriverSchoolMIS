<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学员信息</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>

    </style>
</head>
<body>
<h2>学员信息查看与修改</h2>
<br>
<form class="form-horizontal" role="form">
    <div class="form-group">
        <label class="col-sm-2 control-label">学员ID</label>
        <div class="col-sm-8">
            <input class="form-control" id="stuId" type="text" placeholder="该输入框禁止输入..." disabled>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">学员姓名</label>
        <div class="col-sm-8">
            <input class="form-control" id="stuName" type="text" placeholder="请输入">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">学员年龄</label>
        <div class="col-sm-8">
            <input class="form-control" id="age" type="text" value="该输入框获得焦点...">
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">性别</label>
        <div class="col-sm-8">
            <select class="form-control" id="sex">
                <option value="m">男</option>
                <option value="f">女</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">电子邮箱</label>
        <div class="col-sm-8">
            <input class="form-control" id="email" type="text" placeholder="请输入">
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">教练</label>
        <div class="col-sm-8">
            <select class="form-control" id="coach">
            </select>
        </div>
    </div>

    <div class="form-group text-center">
        <!-- 提供额外的视觉效果，标识一组按钮中的原始动作 -->
        <button type="button" onclick="subStudentInfo()" class="btn btn-primary">修改学生信息</button>
    </div>

</form>

<!--学员教练车使用权限-->
<h3>学员教练车使用权限</h3>
<div>
    <div class="form-group text-center">
        <!-- 提供额外的视觉效果，标识一组按钮中的原始动作 -->
        <button type="button" onclick="addStudentCar()" class="btn btn-primary">添加教练车</button>
        <select class="form-select" aria-label="Default select example" id="selectCar">
            <option selected>选择教练车辆为学生增加权限</option>
            <option value="1">One</option>
            <option value="2">Two</option>
            <option value="3">Three</option>
        </select>

    </div>
    <table class="table table-hover" id="studentCarTable">
        <tr>
            <th>ID</th>
            <th>品牌</th>
            <th>车牌号</th>
            <th>车型</th>
            <th>描述</th>
            <th>操作</th>
        </tr>
    </table>
</div>


<!--学员练车卡信息-->
<h3>学员练车卡信息</h3>
<div>
    <form class="form-horizontal" role="form">
        <div class="form-group">
            <label class="col-sm-2 control-label">练车卡ID</label>
            <div class="col-sm-8">
                <input class="form-control" id="cardId" type="text" placeholder="该输入框禁止输入..." disabled>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">练车卡号</label>
            <div class="col-sm-8">
                <input class="form-control" id="cardNumber" type="text" placeholder="请输入" disabled>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">练车卡名称</label>
            <div class="col-sm-8">
                <input class="form-control" id="cardName" disabled type="text" placeholder="请输入">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">积分</label>
            <div class="col-sm-8">
                <input class="form-control" id="cardCosume" disabled type="text" placeholder="请输入">
            </div>
        </div>


    </form>
</div>



<!--
<div class="addStudentDialog" id="AddInfoForm">
    <table class="table table-hover" id="carsTable">
        <tr>
            <th>Id</th>
            <th>品牌</th>
            <th>车牌号</th>
            <th>车型</th>
            <th>描述</th>
        </tr>
    </table>
</div>
-->


<script>

    // 获取当前也买你的url
    let URL = window.location.href;

    function getUrlParams(url) {
        // 通过 ? 分割获取后面的参数字符串
        let urlStr = url.split('?')[1]
        // 创建空对象存储参数
        let obj = {};
        // 再通过 & 将每一个参数单独分割出来
        let paramsArr = urlStr.split('&')
        for (let i = 0, len = paramsArr.length; i < len; i++) {
            // 再通过 = 将每一个参数分割为 key:value 的形式
            let arr = paramsArr[i].split('=')
            obj[arr[0]] = arr[1];
        }
        return obj
    }

    const stuIdEl = document.querySelector('#stuId');
    const stuNameEl = document.querySelector('#stuName')
    const ageEl = document.querySelector('#age')
    const sexEl = document.querySelector('#sex')
    const emailEl = document.querySelector('#email')
    const coachEl = document.querySelector('#coach')

    const cardIdEl = document.querySelector('#cardId')
    const cardNameEl = document.querySelector('#cardName')
    const cardNumberEl = document.querySelector('#cardNumber')
    const cardCosumeEl = document.querySelector('#cardCosume')

    const selectCarEl = document.querySelector('#selectCar')
    const studentCarTableEl = document.querySelector('#studentCarTable')

    //学员信息
    let studentInfo = {}

    //设置学员信息
    function setStudentInfo(){
        studentInfo.stuId = stuIdEl.value;
        studentInfo.age = ageEl.value
        studentInfo.coachId = coachEl.value
        studentInfo.sex =  sexEl.value;
        studentInfo.email = emailEl.value;
        studentInfo.stuName = stuNameEl.value;
    }

    //渲染学员信息
    function setStudentInfoShow(data) {
        stuIdEl.value = data.stuId;
        ageEl.value = data.age;
        coachEl.value = data.coach.coachId;
        sexEl.value = data.sex;
        emailEl.value = data.email;
        stuNameEl.value = data.stuName;

        const {stuCarCard,coachCars} = data;
        cardIdEl.value = stuCarCard.cardId;
        cardNameEl.value = stuCarCard.cardName;
        cardCosumeEl.value = stuCarCard.cardCosume;
        cardNumberEl.value = stuCarCard.cardNumber;

        //渲染车辆列表
        let htmlContent = ''
        for(let car of coachCars){
            htmlContent += `
            <tr>
                <td>${car.carId}</td>
                <td>${car.carBrand}</td>
                <td>${car.carNumber}</td>
                <td>${car.carType}</td>
                <td>${car.carDesc}</td>
                <td><a onclick="">删除</a></td>
            </tr>
            `
        }
        studentCarTableEl.innerHTML += htmlContent
    }

    //取消学成的车辆的使用授权
    function cancelUseCarAuth(carId){
        fetch('')
    }


    function setCoachCarSelection(){
        let optionsHtml = '';
        //渲染教练车选择信息
        for (let car of coachCars) {
            optionsHtml += `
                <option value="${car.carId}">${car.carBrand}  ${car.carNumber
            }</option>
            `
        }
        selectCarEl.innerHTML += optionsHtml;
    }


    //获取学员西信息
    async function getStudentInfoById() {
        let {id} = getUrlParams(URL)
        // console.log('id',id)
        if (id) {
            const data = await fetch(`/student/${id}`).then(res => res.json())
            if (data.statu === 100) {
                console.log(data)
                setStudentInfoShow(data.data)
            } else {
                alert(data.msg)
            }
        }
    }

    //设置教练选择框中的选项元素
    function setCoachSelection(data) {
        let optionsHtml = '';
        for (let coach of data) {
            optionsHtml += `
                <option value="${coach.coachId}">${coach.coachName
            }</option>
            `
        }
        coachEl.innerHTML += optionsHtml;
    }

    // 获取教练信息
    async function getCoachInfo() {
        const data = await fetch('/coach').then(res => res.json());
        if (data.statu === 100) {
            // console.log(data)
            setCoachSelection(data.data)
        } else {
            alert('获取信息失败,请检查网络状态')
        }

    }

    //修改学员信息
    async function updateStudentInfo(){
        const res = await fetch("/student/update",{
            method:"post",
            body:JSON.stringify(studentInfo),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(res=>res.json())
        if(res.statu === 100){
            alert("修改成功")
            // console.log("修改成功")
            await getStudentInfoById();
        }else{
            alert(res.msg)
        }
    }

    //添加学员信息
    async function addStudentInfo(){

    }

    //提交学员信息
    function subStudentInfo(){
        setStudentInfo();
        let {id} = getUrlParams(URL)
        //如果id存在则为修改学员信息
        if(id){
            updateStudentInfo();
        }else{

        }
    }

    //添加学员教练车
    function addStudentCar(){

    }

    getCoachInfo()
    getStudentInfoById()


</script>
</body>
</html>