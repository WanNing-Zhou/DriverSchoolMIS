<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="style.css" />
    <title>Static Template</title>
    <script src="/static/js/axios.js"></script>
    <script src="/static/js/md5.js"></script>
    <!-- 引入 layui.css -->
    <!-- <link href="//unpkg.com/layui@2.8.0/dist/css/layui.css" rel="stylesheet"> -->
    <link href="https://cdn.bootcdn.net/ajax/libs/layui/2.7.6/css/layui.css" rel="stylesheet">
    <!-- 引入 layui.js -->
    <!-- <script src="//unpkg.com/layui@2.8.0/dist/layui.js" /> -->
    <script src="https://cdn.bootcdn.net/ajax/libs/layui/2.7.6/layui.js"></script>

    <style>
        .rem-btn{
            width: 200px !important;
            display: flex!important;
            margin: 0px;
            padding: 0px;
            justify-content: left;
        }
    </style>
</head>

<body>
    <div class="container">
        <form  class="login-form" onsubmit="return false">
            <h2>登 录</h2>
            <input type="text" name="username" id="username" placeholder="用户名" />
            <input type="password" name="password" id="password" placeholder="密码" />
            <button type="submit" onclick="handleLogin()">登录</button>
            <div>
                <label class="layui-form-label" style="margin: 0px;padding-left: 0px; width: 60px" for="remUser">记住密码</label>
                <input type="checkbox" id="remUser" name="AAA" title="默认">
            </div>
        </form>
    </div>
    <script src="../../static/js/apisHandler.js"></script>
    <script>
        const userNameEl = document.querySelector('#username')
        const passwordEl = document.querySelector('#password')
        const remBtnEl = document.querySelector('#remBtn')

        const layer = layui.layer;

        //记录账户密码功能

        //登录
        async function handleLogin(){
            console.log(remBtnEl)
            console.log(remBtnEl.value)
            const username = userNameEl.value;
            const password =md5(passwordEl.value);
            const reqData = {username,password};
            const respData = await fetch('/user/login',{
                method:'post',
                body: JSON.stringify(reqData),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(res=>{
                const token = res.headers.get('Authorization');
                // console.log(token);
                localStorage.setItem("token",token)
                return res.json()
            })

            // console.log('resp',respData)

            if(respData && respData.status == 200){
                localStorage.setItem("username", username);
                localStorage.setItem('password',password);
                console.log(respData)
                layer.msg('登录成功',{time: 1000},()=>{
                    // location.replace('/pages/index.html');
                })
            }else{
                layer.msg('登录失败')
            }
        }

    </script>
</body>

</html>